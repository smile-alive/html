<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="UTF-8" />
		<title>TodoList - Vue</title>
		<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser/dist/index.global.min.js"></script>
		<script type="importmap">
			{
				"imports": {
					"vue": "https://cdn.jsdelivr.net/npm/vue@3.5.17/dist/vue.esm-browser.js",
					"clsx": "https://cdn.jsdelivr.net/npm/clsx/+esm",
					"tailwind-merge": "https://cdn.jsdelivr.net/npm/tailwind-merge/+esm"
				}
			}
		</script>
	</head>

	<body class="min-h-screen bg-gray-50">
		<div id="root"></div>

		<script type="module">
			import { twMerge } from "tailwind-merge";
			import { clsx } from "clsx";

			window.cn = function cn(...inputs) {
				return twMerge(clsx(inputs));
			};
		</script>

		<script type="module">
			import { createApp, defineComponent, ref, reactive, computed } from "vue";

			const TodoItem = defineComponent({
				emits: ["change"],
				setup(props, { emit, attrs }) {
					const state = reactive({ ...attrs });

					const onToggle = () => {
						emit("change", {
							...state,
							select: !state.select,
							newId: crypto.randomUUID(),
						});
					};

					const onSave = () => {
						emit("change", {
							...state,
							isEdit: false,
							newId: crypto.randomUUID(),
						});
					};

					const onCancel = () => {
						Object.assign(state, {
							isEdit: false,
							content: attrs.content,
						});
					};

					const onEdit = () => {
						Object.assign(state, {
							isEdit: true,
						});
					};

					const onRemove = () => {
						emit("change", null);
					};

					return {
						state,
						onToggle,
						onSave,
						onCancel,
						onEdit,
						onRemove,
						cn,
					};
				},
				template: `
				<li :class="cn('flex w-full items-center gap-2 rounded-lg border border-gray-300 bg-white p-2', state.select && 'bg-green-100')">
					<input
						class="h-4 w-4 rounded-sm border border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500"
						type="checkbox"
						:checked="state.select"
						@change="onToggle"
					/>

					<div class="flex-1">
						<input
							v-if="state.isEdit"
							v-model="state.content"
							class="w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-gray-900 focus:border-blue-500 focus:ring-blue-500"
							autoComplete="off"
						/>
						<div v-else :class="state.select && 'line-through'">{{ state.content }}</div>
					</div>

					<template v-if="state.isEdit">
						<span class="cursor-pointer rounded px-2 py-1 hover:bg-gray-100" @click="onSave">âœ…</span>
						<span class="cursor-pointer rounded px-2 py-1 hover:bg-gray-100" @click="onCancel">âŒ</span>
					</template>

					<template v-else>
						<span class="cursor-pointer rounded px-2 py-1 hover:bg-gray-100" @click="onEdit">âœï¸</span>
						<span class="cursor-pointer rounded px-2 py-1 hover:bg-gray-100" @click="onRemove">ğŸ—‘ï¸</span>
					</template>
				</li>
				`,
			});

			const App = defineComponent({
				components: { TodoItem },
				setup() {
					const list = ref([
						{ id: 1, select: false, content: "ä»£åŠäº‹é¡¹1", isEdit: false },
						{ id: 2, select: false, content: "ä»£åŠäº‹é¡¹2", isEdit: false },
						{ id: 3, select: false, content: "ä»£åŠäº‹é¡¹3", isEdit: false },
					]);

					const completed = computed(
						() => list.value.filter((i) => i.select).length
					);
					const uncompleted = computed(
						() => list.value.length - completed.value
					);
					const checkedAll = computed(() =>
						list.value.every((item) => item.select)
					);

					const handleAddTodo = (event) => {
						const from = new FormData(event.target);
						const todo = from.get("todo");
						if (todo) {
							list.value.push({
								id: list.value.length + 1,
								select: false,
								content: todo,
								isEdit: false,
							});
							event.target.reset();
						}
					};

					const handleChange = (item, originalId) => {
						const index = list.value.findIndex((i) => i.id === originalId);
						if (item) {
							list.value[index] = item;
						} else {
							list.value.splice(index, 1);
						}
					};

					const handleSelectAll = (event) => {
						list.value = list.value.map((item) => {
							item.select = event.target.checked;
							item.newId = crypto.randomUUID();
							return item;
						});
					};

					return {
						list,
						completed,
						uncompleted,
						checkedAll,
						handleAddTodo,
						handleChange,
						handleSelectAll,
					};
				},
				template: `
						<div class="mx-auto w-full max-w-xl space-y-6 p-6">
							<h1 class='text-center text-2xl font-bold'>Vue TodoList Demo</h1>

							<form class="flex items-center gap-3" @submit.prevent="handleAddTodo">
								<input
									class="h-4 w-4 rounded-sm border border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500"
									type="checkbox"
									:checked="checkedAll"
									@change="handleSelectAll"
								/>
								<input
									class="flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
									name="todo"
									autoComplete="off"
									placeholder="è¯·è¾“å…¥äº‹é¡¹..."
								/>
								<button class="rounded-lg bg-blue-600 px-4 py-2 font-semibold text-white shadow hover:bg-blue-700" type="submit">æ·»åŠ </button>
							</form>

							<ul class="w-full space-y-2">
								<todo-item v-for="item in list" :key="item.newId ?? item.id" v-bind="item" @change="handleChange($event, item.id)" />
							</ul>

							<div class="w-full rounded-lg bg-gray-100 p-4 shadow-md">
								<h2 class="font-medium">æ•°ç»„çŠ¶æ€ç»Ÿè®¡ï¼š</h2>
								<p>â€¢ æ•°ç»„é•¿åº¦: {{ list.length }}</p>
								<p>â€¢ å·²å®Œæˆ: {{ completed }}</p>
								<p>â€¢ æœªå®Œæˆ: {{ uncompleted }}</p>
								<p>â€¢ å®Œæˆç‡: {{ Math.floor((completed / list.length) * 100) }}%</p>
							</div>
						</div>
				`,
			});

			createApp(App).mount("#root");
		</script>
	</body>
</html>
